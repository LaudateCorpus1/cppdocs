


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tensor Creation API &mdash; PyTorch master documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/notes/tensor_creation.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tensor Basics" href="tensor_basics.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/features">Features</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active">
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <a href="https://pytorch.org/resources">Resources</a>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  master
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing C++ Distributions of PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">The C++ Frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/library_root.html">Library API</a></li>
</ul>
<p class="caption"><span class="caption-text">Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_basics.html">Tensor Basics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tensor Creation API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Tensor Creation API</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/notes/tensor_creation.rst.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="tensor-creation-api">
<h1>Tensor Creation API<a class="headerlink" href="#tensor-creation-api" title="Permalink to this headline">¶</a></h1>
<p>This note describes how to create tensors in the PyTorch C++ API. It highlights
the available factory functions, which populate new tensors according to some
algorithm, and lists the options available to configure the shape, data type,
device and other properties of a new tensor.</p>
<div class="section" id="factory-functions">
<h2>Factory Functions<a class="headerlink" href="#factory-functions" title="Permalink to this headline">¶</a></h2>
<p>A <em>factory function</em> is a function that produces a new tensor. There are many
factory functions available in PyTorch (both in Python and C++), which differ
in the way they initialize a new tensor before returning it. All factory
functions adhere to the following general “schema”:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::&lt;</span><span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">function</span><span class="o">-</span><span class="n">specific</span><span class="o">-</span><span class="n">options</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">sizes</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tensor</span><span class="o">-</span><span class="n">options</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s bisect the various parts of this “schema”:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;function-name&gt;</span></code> is the name of the function you would like to invoke,</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;functions-specific-options&gt;</span></code> are any required or optional parameters a particular factory function accepts,</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;sizes&gt;</span></code> is an object of type <code class="docutils literal notranslate"><span class="pre">IntList</span></code> and specifies the shape of the resulting tensor,</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;tensor-options&gt;</span></code> is an instance of <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> and configures the data type, device, layout and other properties of the resulting tensor.</li>
</ol>
<div class="section" id="picking-a-factory-function">
<h3>Picking a Factory Function<a class="headerlink" href="#picking-a-factory-function" title="Permalink to this headline">¶</a></h3>
<p>The following factory functions are available at the time of this writing (the
hyperlinks lead to the corresponding Python functions, since they often have
more eloquent documentation – the options are the same in C++):</p>
<ul class="simple">
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.arange">arange</a>: Returns a tensor with a sequence of integers,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.empty">empty</a>: Returns a tensor with uninitialized values,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.eye">eye</a>: Returns an identity matrix,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.full">full</a>: Returns a tensor filled with a single value,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.linspace">linspace</a>: Returns a tensor with values linearly spaced in some interval,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.logspace">logspace</a>: Returns a tensor with values logarithmically spaced in some interval,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.ones">ones</a>: Returns a tensor filled with all ones,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.rand">rand</a>: Returns a tensor filled with values drawn from a uniform distribution on <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1)</span></code>.</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.randint">randint</a>: Returns a tensor with integers randomly drawn from an interval,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.randn">randn</a>: Returns a tensor filled with values drawn from a unit normal distribution,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.randperm">randperm</a>: Returns a tensor filled with a random permutation of integers in some interval,</li>
<li><a class="reference external" href="https://pytorch.org/docs/stable/torch.html#torch.zeros">zeros</a>: Returns a tensor filled with all zeros.</li>
</ul>
</div>
<div class="section" id="specifying-a-size">
<h3>Specifying a Size<a class="headerlink" href="#specifying-a-size" title="Permalink to this headline">¶</a></h3>
<p>Functions that do not require specific arguments by nature of how they fill the
tensor can be invoked with just a size. For example, the following line creates
a vector with 5 components, initially all set to 1:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
<p>What if we wanted to instead create a <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">x</span> <span class="pre">5</span></code> matrix, or a <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">x</span> <span class="pre">3</span> <span class="pre">x</span> <span class="pre">4</span></code>
tensor? In general, an <code class="docutils literal notranslate"><span class="pre">IntList</span></code> – the type of the size parameter of factory
functions – is constructed by specifying the size along each dimension in
curly braces. For example, <code class="docutils literal notranslate"><span class="pre">{2,</span> <span class="pre">3}</span></code> for a tensor (in this case matrix) with
two rows and three columns, <code class="docutils literal notranslate"><span class="pre">{3,</span> <span class="pre">4,</span> <span class="pre">5}</span></code> for a three-dimensional tensor, and
<code class="docutils literal notranslate"><span class="pre">{2}</span></code> for a one-dimensional tensor with two components. In the one
dimensional case, you can omit the curly braces and just pass the single
integer like we did above. Note that the squiggly braces are just one way of
constructing an <code class="docutils literal notranslate"><span class="pre">IntList</span></code>. You can also pass an <code class="docutils literal notranslate"><span class="pre">std::vector&lt;int64_t&gt;</span></code> and
a few other types. Either way, this means we can construct a three-dimensional
tensor filled with values from a unit normal distribution by writing:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">randn</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">});</span>
<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">sizes</span><span class="p">()</span> <span class="o">==</span> <span class="n">torch</span><span class="o">::</span><span class="n">IntList</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>
</pre></div>
</div>
<p>Notice how we use <code class="docutils literal notranslate"><span class="pre">tensor.sizes()</span></code> to get back an <code class="docutils literal notranslate"><span class="pre">IntList</span></code> containing the
sizes we passed to the tensor. You can also write <code class="docutils literal notranslate"><span class="pre">tensor.size(i)</span></code> to access
a single dimension, which is equivalent to but preferred over
<code class="docutils literal notranslate"><span class="pre">tensor.sizes()[i]</span></code>.</p>
</div>
<div class="section" id="passing-function-specific-parameters">
<h3>Passing Function-Specific Parameters<a class="headerlink" href="#passing-function-specific-parameters" title="Permalink to this headline">¶</a></h3>
<p>Neither <code class="docutils literal notranslate"><span class="pre">ones</span></code> nor <code class="docutils literal notranslate"><span class="pre">randn</span></code> accept any additional parameters to change their
behavior. One function which does require further configuration is <code class="docutils literal notranslate"><span class="pre">randint</span></code>,
which takes an upper bound on the value for the integers it generates, as well
as an optional lower bound, which defaults to zero. Here we create a <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">x</span> <span class="pre">5</span></code>
square matrix with integers between 0 and 10:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">randint</span><span class="p">(</span><span class="cm">/*high=*/</span><span class="mi">10</span><span class="p">,</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">});</span>
</pre></div>
</div>
<p>And here we raise the lower bound to 3:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">randint</span><span class="p">(</span><span class="cm">/*low=*/</span><span class="mi">3</span><span class="p">,</span> <span class="cm">/*high=*/</span><span class="mi">10</span><span class="p">,</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">});</span>
</pre></div>
</div>
<p>The inline comments <code class="docutils literal notranslate"><span class="pre">/*low=*/</span></code> and <code class="docutils literal notranslate"><span class="pre">/*high=*/</span></code> are not required of course,
but aid readability just like keyword arguments in Python.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The main take-away is that the size always follows the function specific
arguments.</p>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Sometimes a function does not need a size at all. For example, the size of
the tensor returned by <code class="docutils literal notranslate"><span class="pre">arange</span></code> is fully specified by its function-specific
arguments – the lower and upper bound of a range of integers. In that case
the function does not take a <code class="docutils literal notranslate"><span class="pre">size</span></code> parameter.</p>
</div>
</div>
<div class="section" id="configuring-properties-of-the-tensor">
<h3>Configuring Properties of the Tensor<a class="headerlink" href="#configuring-properties-of-the-tensor" title="Permalink to this headline">¶</a></h3>
<p>The previous section discussed function-specific arguments. Function-specific
arguments can only change the values with which tensors are filled, and
sometimes the size of the tensor. They never change things like the data type
(e.g. <code class="docutils literal notranslate"><span class="pre">float32</span></code> or <code class="docutils literal notranslate"><span class="pre">int64</span></code>) of the tensor being created, or whether it
lives in CPU or GPU memory. The specification of these properties is left to
the very last argument to every factory function: a <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object,
discussed below.</p>
<p><code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> is a class that encapsulates the construction axes of a
Tensor. With <em>construction axis</em> we mean a particular property of a Tensor that
can be configured before its construction (and sometimes changed afterwards).
These construction axes are:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">dtype</span></code> (previously “scalar type”), which controls the data type of the
elements stored in the tensor,</li>
<li>The <code class="docutils literal notranslate"><span class="pre">layout</span></code>, which is either strided (dense) or sparse,</li>
<li>The <code class="docutils literal notranslate"><span class="pre">device</span></code>, which represents a compute device on which a tensor is stored (like a CPU or CUDA GPU),</li>
<li>The <code class="docutils literal notranslate"><span class="pre">requires_grad</span></code> boolean to enable or disable gradient recording for a tensor,</li>
</ul>
<p>If you are used to PyTorch in Python, these axes will sound very familiar. The
allowed values for these axes at the moment are:</p>
<ul class="simple">
<li>For <code class="docutils literal notranslate"><span class="pre">dtype</span></code>: <code class="docutils literal notranslate"><span class="pre">kUInt8</span></code>, <code class="docutils literal notranslate"><span class="pre">kInt8</span></code>, <code class="docutils literal notranslate"><span class="pre">kInt16</span></code>, <code class="docutils literal notranslate"><span class="pre">kInt32</span></code>, <code class="docutils literal notranslate"><span class="pre">kInt64</span></code>, <code class="docutils literal notranslate"><span class="pre">kFloat32</span></code> and <code class="docutils literal notranslate"><span class="pre">kFloat64</span></code>,</li>
<li>For <code class="docutils literal notranslate"><span class="pre">layout</span></code>: <code class="docutils literal notranslate"><span class="pre">kStrided</span></code> and <code class="docutils literal notranslate"><span class="pre">kSparse</span></code>,</li>
<li>For <code class="docutils literal notranslate"><span class="pre">device</span></code>: Either <code class="docutils literal notranslate"><span class="pre">kCPU</span></code>, or <code class="docutils literal notranslate"><span class="pre">kCUDA</span></code> (which accepts an optional device index),</li>
<li>For <code class="docutils literal notranslate"><span class="pre">requires_grad</span></code>: either <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">There exist “Rust-style” shorthands for dtypes, like <code class="docutils literal notranslate"><span class="pre">kF32</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">kFloat32</span></code>. See <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/csrc/api/include/torch/types.h">here</a>
for the full list.</p>
</div>
<p>An instance of <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> stores a concrete value for each of these
axes. Here is an example of creating a <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object that represents
a 64-bit float, strided tensor that requires a gradient, and lives on CUDA
device 1:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">options</span> <span class="o">=</span>
  <span class="n">torch</span><span class="o">::</span><span class="n">TensorOptions</span><span class="p">()</span>
    <span class="p">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">)</span>
    <span class="p">.</span><span class="n">layout</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kStrided</span><span class="p">)</span>
    <span class="p">.</span><span class="n">device</span><span class="p">({</span><span class="n">torch</span><span class="o">::</span><span class="n">kCUDA</span><span class="p">,</span> <span class="mi">1</span><span class="p">})</span>
    <span class="p">.</span><span class="n">requires_grad</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Notice how we use the ‘“builder”-style methods of <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> to
construct the object piece by piece. If we pass this object as the last
argument to a factory function, the newly created tensor will have these
properties:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">full</span><span class="p">(</span><span class="cm">/*value=*/</span><span class="mi">123</span><span class="p">,</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span> <span class="n">options</span><span class="p">);</span>

<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">dtype</span><span class="p">()</span> <span class="o">==</span> <span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">layout</span><span class="p">()</span> <span class="o">==</span> <span class="n">torch</span><span class="o">::</span><span class="n">kStrided</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">device</span><span class="p">().</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">torch</span><span class="o">::</span><span class="n">kCUDA</span><span class="p">);</span> <span class="c1">// or device().is_cuda()</span>
<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">device</span><span class="p">().</span><span class="n">index</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">requires_grad</span><span class="p">())</span>

<span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="p">.</span><span class="n">options</span><span class="p">()</span> <span class="o">==</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, you may be thinking: do I really need to specify each axis for every new
tensor I create? Fortunately, the answer is “no”, as <strong>every axis has a default
value</strong>. These defaults are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">kFloat32</span></code> for the dtype,</li>
<li><code class="docutils literal notranslate"><span class="pre">kStrided</span></code> for the layout,</li>
<li><code class="docutils literal notranslate"><span class="pre">kCPU</span></code> for the device,</li>
<li><code class="docutils literal notranslate"><span class="pre">false</span></code> for <code class="docutils literal notranslate"><span class="pre">requires_grad</span></code>.</li>
</ul>
<p>What this means is that any axis you omit during the construction of a
<code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object will take on its default value. For example, this is
our previous <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object, but with the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> and <code class="docutils literal notranslate"><span class="pre">layout</span></code>
defaulted:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">options</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">TensorOptions</span><span class="p">().</span><span class="n">device</span><span class="p">({</span><span class="n">torch</span><span class="o">::</span><span class="n">kCUDA</span><span class="p">,</span> <span class="mi">1</span><span class="p">}).</span><span class="n">requires_grad</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>In fact, we can even omit all axes to get an entirely defaulted
<code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">options</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">TensorOptions</span><span class="p">();</span> <span class="c1">// or `torch::TensorOptions options;`</span>
</pre></div>
</div>
<p>A nice consequence of this is that the <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object we just spoke
so much about can be entirely omitted from any tensor factory call:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// A 32-bit float, strided, CPU tensor that does not require a gradient.</span>
<span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">randn</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">});</span>
<span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>But the sugar gets sweeter: In the API presented here so far, you may have
noticed that the initial <code class="docutils literal notranslate"><span class="pre">torch::TensorOptions()</span></code> is quite a mouthful to
write. The good news is that for every construction axis (dtype, layout, device
and <code class="docutils literal notranslate"><span class="pre">requires_grad</span></code>), there is one <em>free function</em> in the <code class="docutils literal notranslate"><span class="pre">torch::</span></code>
namespace which you can pass a value for that axis. Each function then returns
a <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> object preconfigured with that axis, but allowing even
further modification via the builder-style methods shown above. For example,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">TensorOptions</span><span class="p">().</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">))</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">))</span>
</pre></div>
</div>
<p>and further instead of</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">TensorOptions</span><span class="p">().</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">).</span><span class="n">layout</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kStrided</span><span class="p">))</span>
</pre></div>
</div>
<p>we can just write</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">).</span><span class="n">layout</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kStrided</span><span class="p">))</span>
</pre></div>
</div>
<p>which saves us quite a bit of typing. What this means is that in practice, you
should barely, if ever, have to write out <code class="docutils literal notranslate"><span class="pre">torch::TensorOptions</span></code>. Instead use
the <code class="docutils literal notranslate"><span class="pre">torch::dtype()</span></code>, <code class="docutils literal notranslate"><span class="pre">torch::device()</span></code>, <code class="docutils literal notranslate"><span class="pre">torch::layout()</span></code> and
<code class="docutils literal notranslate"><span class="pre">torch::requires_grad()</span></code> functions.</p>
<p>A final bit of convenience is that <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> is implicitly
constructible from individual values. This means that whenever a function has a
parameter of type <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code>, like all factory functions do, we can
directly pass a value like <code class="docutils literal notranslate"><span class="pre">torch::kFloat32</span></code> or <code class="docutils literal notranslate"><span class="pre">torch::kStrided</span></code> in place
of the full object. Therefore, when there is only a single axis we would like
to change compared to its default value, we can pass only that value. As such,
what was</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">TensorOptions</span><span class="p">().</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">))</span>
</pre></div>
</div>
<p>became</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">))</span>
</pre></div>
</div>
<p>and can finally be shortened to</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course, it is not possible to modify further properties of the
<code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> instance with this short syntax, but if all we needed was to
change one property, this is quite practical.</p>
<p>In conclusion, we can now compare how <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> defaults, together with
the abbreviated API for creating <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> using free functions, allow
tensor creation in C++ with the same convenience as in Python. Compare this
call in Python:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>torch.randn(3, 4, dtype=torch.float32, device=torch.device(&#39;cuda&#39;, 1), requires_grad=True)
</pre></div>
</div>
<p>with the equivalent call in C++:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">randn</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span> <span class="n">torch</span><span class="o">::</span><span class="n">dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">).</span><span class="n">device</span><span class="p">({</span><span class="n">torch</span><span class="o">::</span><span class="n">kCUDA</span><span class="p">,</span> <span class="mi">1</span><span class="p">}).</span><span class="n">requires_grad</span><span class="p">(</span><span class="nb">true</span><span class="p">))</span>
</pre></div>
</div>
<p>Pretty close!</p>
</div>
</div>
<div class="section" id="conversion">
<h2>Conversion<a class="headerlink" href="#conversion" title="Permalink to this headline">¶</a></h2>
<p>Just as we can use <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> to configure how new tensors should be
created, we can also use <code class="docutils literal notranslate"><span class="pre">TensorOptions</span></code> to convert a tensor from one set of
properties to a new set of properties. Such a conversion usually creates a new
tensor and does not occur in-place. For example, if we have a <code class="docutils literal notranslate"><span class="pre">source_tensor</span></code>
created with</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">source_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">::</span><span class="n">randn</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span> <span class="n">torch</span><span class="o">::</span><span class="n">kInt64</span><span class="p">);</span>
</pre></div>
</div>
<p>we can convert it from <code class="docutils literal notranslate"><span class="pre">int64</span></code> to <code class="docutils literal notranslate"><span class="pre">float32</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">float_tensor</span> <span class="o">=</span> <span class="n">source_tensor</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kFloat32</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The result of the conversion, <code class="docutils literal notranslate"><span class="pre">float_tensor</span></code>, is a new tensor pointing to
new memory, unrelated to the source <code class="docutils literal notranslate"><span class="pre">source_tensor</span></code>.</p>
</div>
<p>We can then move it from CPU memory to GPU memory:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">gpu_tensor</span> <span class="o">=</span> <span class="n">float_tensor</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kCUDA</span><span class="p">);</span>
</pre></div>
</div>
<p>If you have multiple CUDA devices available, the above code will copy the
tensor to the <em>default</em> CUDA device, which you can configure with a
<code class="docutils literal notranslate"><span class="pre">torch::DeviceGuard</span></code>. If no <code class="docutils literal notranslate"><span class="pre">DeviceGuard</span></code> is in place, this will be GPU
1. If you would like to specify a different GPU index, you can pass it to
the <code class="docutils literal notranslate"><span class="pre">Device</span></code> constructor:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">gpu_two_tensor</span> <span class="o">=</span> <span class="n">float_tensor</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">Device</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kCUDA</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
<p>In the case of CPU to GPU copy and reverse, we can also configure the memory
copy to be <em>asynchronous</em> by passing <code class="docutils literal notranslate"><span class="pre">/*non_blocking=*/false</span></code> as the last
argument to <code class="docutils literal notranslate"><span class="pre">to()</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">::</span><span class="n">Tensor</span> <span class="n">async_cpu_tensor</span> <span class="o">=</span> <span class="n">gpu_tensor</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">::</span><span class="n">kCPU</span><span class="p">,</span> <span class="cm">/*non_blocking=*/</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This note hopefully gave you a good understanding of how to create and convert
tensors in an idiomatic fashion using the PyTorch C++ API. If you have any
further questions or suggestions, please use our <a class="reference external" href="https://discuss.pytorch.org/">forum</a> or <a class="reference external" href="https://github.com/pytorch/pytorch/issues">GitHub issues</a> to get in touch.</p>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="tensor_basics.html" class="btn btn-neutral" title="Tensor Basics" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Torch Contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Tensor Creation API</a><ul>
<li><a class="reference internal" href="#factory-functions">Factory Functions</a><ul>
<li><a class="reference internal" href="#picking-a-factory-function">Picking a Factory Function</a></li>
<li><a class="reference internal" href="#specifying-a-size">Specifying a Size</a></li>
<li><a class="reference internal" href="#passing-function-specific-parameters">Passing Function-Specific Parameters</a></li>
<li><a class="reference internal" href="#configuring-properties-of-the-tensor">Configuring Properties of the Tensor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conversion">Conversion</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script type="text/javascript" src="../_static/jquery.js"></script>
         <script type="text/javascript" src="../_static/underscore.js"></script>
         <script type="text/javascript" src="../_static/doctools.js"></script>
         <script type="text/javascript" src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
         <script type="text/javascript" src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://pytorch.org/resources">Resources</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/support">Support</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.slack.com" target="_blank">Slack</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md" target="_blank">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Follow Us</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="#">Get Started</a>
          </li>

          <li>
            <a href="#">Features</a>
          </li>

          <li>
            <a href="#">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active">
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <a href="https://pytorch.org/resources">Resources</a>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>